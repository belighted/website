lang: "en"
slug: "xml-building"
originalPath: "https://www.belighted.com/blog/xml-building"
title: "Handcrafted xml files with Ruby!"
author: "Stéphane A."
description: "How to easily write your own XML files in Ruby ! 2 methods accessible for all !"
image: "https://www.belighted.com/hubfs/blog%20tech%20standard%20image-1.png#keepProtocol"
date: 1388534400000
body: "<p>On a daily basis we build API in order to feed all our projects ( such as our hot new <a href=\"https://nomadsuite.com/\">NomadSuite</a> ) and in our way to face such difficulties, we rely on the good old JSON format.</p>\n<!--more-->\n<p>But sometimes, the industry standards required us to use the well known and spread XML format.</p>\n<p>Here are two gems that can allow you to easily craft your own xml file, an old one called <a href=\"https://github.com/jimweirich/builder\">Builder</a> and another, a bit more complete, called <a href=\"https://github.com/sparklemotion/nokogiri\">Nokogiri</a>.</p>\n<p>We’ll take this last one to show you, what are these capabilities:</p>\n<p>First of all, add <code>gem \"nokogiri\"</code> to your gemfile and run the <code>bundle install</code> command.</p>\n<p>Then, start to write your script !</p>\n<figure class=\"code\">\n<div class=\"highlight\">\n<table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n<span class=\"line-number\">9</span>\n<span class=\"line-number\">10</span>\n<span class=\"line-number\">11</span>\n<span class=\"line-number\">12</span>\n<span class=\"line-number\">13</span>\n<span class=\"line-number\">14</span>\n<span class=\"line-number\">15</span>\n<span class=\"line-number\">16</span>\n<span class=\"line-number\">17</span>\n<span class=\"line-number\">18</span>\n<span class=\"line-number\">19</span>\n<span class=\"line-number\">20</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"n\">builder</span> <span class=\"o\">=</span> <span class=\"ss\"><span class=\"constant\">Nokogiri</span></span><span class=\"constant\"><span class=\"p\">:</span><span class=\"ss\">:XML</span><span class=\"o\">::</span><span class=\"no\">Builder</span></span><span class=\"no\"></span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"ss\"><span class=\"symbol\">:encoding</span></span> <span class=\"o\">=&gt;</span> <span class=\"s1\"><span class=\"string\">'UTF-8'</span></span><span class=\"p\">)</span> <span class=\"k\"><span class=\"keyword\">do</span></span> <span class=\"o\">|</span><span class=\"n\">xml</span><span class=\"o\">|</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">Documents</span></span> <span class=\"p\">{</span>\n</span><span class=\"line\"> <span class=\"n\">documents</span><span class=\"o\">.</span><span class=\"n\">each</span> <span class=\"k\"><span class=\"keyword\">do</span></span> <span class=\"o\">|</span><span class=\"n\">document</span><span class=\"o\">|</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">Document</span></span> <span class=\"p\">{</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">DocumentTypeH</span></span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_type</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">DocumentNb</span></span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_nb</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">Lines</span></span> <span class=\"p\">{</span>\n</span><span class=\"line\"> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">lines</span><span class=\"o\">.</span><span class=\"n\">each_with_index</span> <span class=\"k\"><span class=\"keyword\">do</span></span> <span class=\"o\">|</span><span class=\"n\">line</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"o\">|</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">Line</span></span> <span class=\"p\">{</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">DocumentType</span></span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_type</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">DocumentNb</span></span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_nb</span>\n</span><span class=\"line\"> <span class=\"n\">xml</span><span class=\"o\">.</span><span class=\"n\"><span class=\"constant\">LineNb</span></span> <span class=\"p\">(</span><span class=\"n\">index</span> <span class=\"o\">+</span> <span class=\"mi\"><span class=\"number\">1</span></span><span class=\"p\">)</span>\n</span><span class=\"line\"> <span class=\"p\">}</span>\n</span><span class=\"line\"> <span class=\"k\"><span class=\"keyword\">end</span></span>\n</span><span class=\"line\"> <span class=\"p\">}</span>\n</span><span class=\"line\"> <span class=\"p\">}</span>\n</span><span class=\"line\"> <span class=\"k\"><span class=\"keyword\">end</span></span>\n</span><span class=\"line\"> <span class=\"p\">}</span>\n</span><span class=\"line\"> <span class=\"k\"><span class=\"keyword\">end</span></span>\n</span><span class=\"line\"><span class=\"n\">builder</span><span class=\"o\">.</span><span class=\"n\">to_xml</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</div>\n</figure>\n<p>Another option that we consider sometimes, is also to use the famous <code>erb</code> template language to generate the desired XML output.</p>\n<p>For instance, have a look at this small piece of code:</p>\n<p>You basicaly need nothing more than ruby (as <code>erb</code> is a ruby core library).</p>\n<p>Just instanciate the class: <code>ERB.new(File.read(\"./documents.xml.erb\"), 0, '&gt;').result(binding)</code> (<code>binding</code> allow you to access all call context variables).</p>\n<p>Then, here is the XML template:</p>\n<figure class=\"code\">\n<figcaption><span>./documents.xml.erb </span></figcaption>\n<div class=\"highlight\">\n<table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n<span class=\"line-number\">9</span>\n<span class=\"line-number\">10</span>\n<span class=\"line-number\">11</span>\n<span class=\"line-number\">12</span>\n<span class=\"line-number\">13</span>\n<span class=\"line-number\">14</span>\n<span class=\"line-number\">15</span>\n<span class=\"line-number\">16</span>\n<span class=\"line-number\">17</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"o\">&lt;</span><span class=\"no\">Documents</span><span class=\"o\">&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"sx\">% documents.each </span><span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">document</span><span class=\"o\">|</span> <span class=\"sx\">%&gt;</span>\n</span><span class=\"line\"><span class=\"sx\"> &lt;Document&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"no\">DocumentTypeH</span><span class=\"o\">&gt;&lt;</span><span class=\"sx\">%= document.document_type %&gt;&lt;/DocumentTypeH&gt;</span>\n</span><span class=\"line\"><span class=\"sx\"> &lt;DocumentNb&gt;&lt;%=</span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_nb</span> <span class=\"sx\">%&gt;&lt;/DocumentNb&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"no\">Lines</span><span class=\"o\">&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"sx\">% document.lines.each_with_index </span><span class=\"k\">do</span> <span class=\"o\">|</span><span class=\"n\">line</span><span class=\"p\">,</span> <span class=\"n\">index</span><span class=\"o\">|</span> <span class=\"sx\">%&gt;</span>\n</span><span class=\"line\"><span class=\"sx\"> &lt;Line&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"no\">DocumentType</span><span class=\"o\">&gt;&lt;</span><span class=\"sx\">%= document.document_type %&gt;&lt;/DocumentType&gt;</span>\n</span><span class=\"line\"><span class=\"sx\"> &lt;DocumentNb&gt;&lt;%=</span> <span class=\"n\">document</span><span class=\"o\">.</span><span class=\"n\">document_nb</span> <span class=\"sx\">%&gt;&lt;/DocumentNb&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"no\">LineNb</span><span class=\"o\">&gt;&lt;%=</span> <span class=\"n\">index</span> <span class=\"o\">+</span> <span class=\"mi\">1</span> <span class=\"sx\">%&gt;&lt;/LineNb&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"sr\">/Line&gt;</span>\n</span><span class=\"line\"><span class=\"sr\"> &lt;% end %&gt;</span>\n</span><span class=\"line\"><span class=\"sr\"> &lt;/</span><span class=\"no\">Lines</span><span class=\"o\">&gt;</span>\n</span><span class=\"line\"> <span class=\"o\">&lt;</span><span class=\"sr\">/Document&gt;</span>\n</span><span class=\"line\"><span class=\"sr\"> &lt;% end %&gt;</span>\n</span><span class=\"line\"><span class=\"sr\">&lt;/</span><span class=\"no\">Documents</span><span class=\"o\">&gt;</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table>\n</div>\n</figure>\n<p>Don’t hesitate to share your xml creation process !<br><br><!--HubSpot Call-to-Action Code --><span class=\"hs-cta-wrapper\" id=\"hs-cta-wrapper-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><span class=\"hs-cta-node hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" id=\"hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><!--[if lte IE 8]><div id=\"hs-cta-ie-element\"></div><![endif]--><a href=\"https://cta-redirect.hubspot.com/cta/redirect/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" target=\"_blank\"><img class=\"hs-cta-img\" id=\"hs-cta-img-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" style=\"border-width:0px;\" src=\"https://no-cache.hubspot.com/cta/default/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2.png\" alt=\"New Call-to-action\"></a></span></span><!-- end HubSpot Call-to-Action Code --></p>\n<div id=\"disqus_thread\">&nbsp;</div>"
tags:
  - label: "Under the hood"
    value: "under-the-hood"

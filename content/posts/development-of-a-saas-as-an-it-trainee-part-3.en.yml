lang: en
slug: development-of-a-saas-as-an-it-trainee-part-3
originalPath: https://www.belighted.com/blog/development-of-a-saas-as-an-it-trainee-part-3
title: "Development of a SaaS as an IT trainee : part 3"
author: Samuel M.
description: Development of a SaaS with a third-party javascript widget, what I
  learn and discover all along this project.
image: default_blogpost_image_6@1x.jpg
date: 1451606400000
body: >-
  <h2>Introduction</h2>

  <p>Day after day, Pravatar is growing.<br> My work these days is more about details and refactoring than brand new features, yet it might be the most important part of a good <strong><a href="/saas-guide-to-software-as-service" rel=" noopener" target="_blank">SaaS</a></strong> project.</p>

  <!--more-->

  <h2>Backend</h2>

  <h3>JSON:API</h3>

  <p>In order to build Pravatar on good and maintainable bases for the Belighters who will continue the project at the end of my internship, Philippe asked me to change my API to make it compliant to the <strong>JSON:API</strong> specification.<br> This specification is pretty simple and clear, describing what your API <strong>must</strong>, <strong>may</strong> or <strong>should</strong> ask and answer.</p>

  <p>However, these changes made me reconsider this API and helped me to <em>increase</em> the code <em>quality</em>, but also made me <em>learn</em> a lot of new useful things.</p>

  <h4>ActiveModel Serializer</h4>

  <p>As you may know, one of the first things the JSON:API stands is that your API <strong>must</strong> respond or be requested with a <strong>single resource object</strong> containing at least its <em>id</em> and <em>type</em>.</p>

  <p>Although it sounds logical to me now, considering I want to follow a <strong>RESTful</strong> architecture, I was making some mistakes :</p>

  <ul>

  <li>My API responses and requests weren't correctly composed of a single (or an array of) resource object.</li>

  <li>I was building the JSON responses in the API controller.</li>

  </ul>

  <p>As the responses must represent a <em>single resource object</em>, the simplest way to move the representation responsibility out the controller and to be compliant to the specification is to use <strong>ActiveModel Serializer</strong>.<br> This gem lets you define serializers basically defining the "JSON representation" of a resource. These serializers will be used when calling :<br> <code>render json: your_resource</code></p>

  <p>This being done, I achieved to move out pieces of code which weren't supposed to be under the responsibility of the controller and to correctly follow the JSON:API specification.<br> Moreover, when my API now calls <code>render json: profile</code>, it really does what it means.<br> It's not anymore about rendering some JSON I build previously, is about rendering the <em>resource</em> the client requested.<br> The intent is <em>clear</em> and <em>precise</em>.</p>

  <h3>JSON Web Tokens</h3>

  <p>Pravatar was pretty simple back then, but a question fastly came up after I implemented the upload : <em>How to ensure an upload is legit ?</em></p>

  <p>When I first considered the problem, I came up with a homemade solution.<br> That solution was actually working fairly good, but I later discovered <strong>JSON Web Tokens</strong> which was the right choice to solve the problem, for these reasons :</p>

  <ul>

  <li>It's an effective way to communicate a small payload of information between two sources via an unsecured transport</li>

  <li>It can be sent inside a HTTP header</li>

  <li>It is signed with a secret (our API keys in that case)</li>

  </ul>

  <p>This allowed me to follow the JSON:API, and to send meta informations related to the request and not directly to the resource inside the <em>JWT</em>.<br> Putting these fields (like the upload's datetime) inside the JWT's payload and signing it with the API key was the simplest way to ensure the upload validity.</p>

  <p>JWT also provides a solution for <strong>authentication</strong> via APIs.</p>

  <h2>Frontend</h2>

  <h3>Browserify</h3>

  <p>At some point of the project, a terrible thing happened: my javascript went all <em>spaghetti</em>; the snippet was a single code file made of multiple functions calling each other.<br> I overstate it a little bit, but I can be sure it would have been a total mess with the code growth.<br> This was the time to <strong>take action</strong>.</p>

  <p>Funny thing is that I already was including the right tool to achieve this from the beginning: the great Browserify.</p>

  <p>I divided the code in <em>modules</em>, each one beeing a class and having its own responsibility.<br> Then, like I require <em>jquery</em> in the main module for the bundling, I can <code>require</code> my other modules, providing me with an instance of the class with its public functions.</p>

  <p>Organizing your code with <em>Browserify</em> <strong>forces</strong> you to correctly dispatch the responsibilities between your modules.<br> Indeed, if your module <strong>A</strong> require the module <strong>B</strong> to run but <strong>B</strong> also require <strong>A</strong>, you create a <em>circular dependency</em> that will prevent your script to run.</p>

  <h3>Engine</h3>

  <p>As long as there was no security feature in Pravatar, client could just use the javascript snippet and write html tags to fetch and upload the avatars.</p>

  <p>Implementing the security system meant finding a way to make the client generates the <strong>JWT</strong> with its <em>API Key</em>.</p>

  <p>I achieved this by building a gem for a Rails client app. This gem is an engine, providing the client with:</p>

  <ul>

  <li>Helpers method to create fetch and upload tags</li>

  <li>A generator to copy the html templates of the generators and allow the clients to modify them following their own taste.</li>

  </ul>

  <p>The client just has to install the gem and to set its API Key in <code>secret.yml</code>, then he's ready to use Pravatar.</p>

  <h2>Conclusion</h2>

  <p>I remember thinking how far I was from completing this projet during my first weeks at Belighted.<br> Actually, I'm quite impressed to see what I've learned during these seven weeks and what I'm able to achieve today.<br> I'm very grateful to Belighted for having taken me as a trainee and made me progress that much.</p>

  <p>There is still six weeks of internship to enjoy !<br><br><!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2"><span class="hs-cta-node hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2" id="hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2" target="_blank"><img class="hs-cta-img" id="hs-cta-img-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2.png" alt="New Call-to-action"></a></span></span><!-- end HubSpot Call-to-Action Code --></p>

  <div id="disqus_thread">&nbsp;</div>
tags:
  - label: Under the hood
    value: under-the-hood

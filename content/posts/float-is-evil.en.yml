lang: "en"
slug: "float-is-evil"
originalPath: "https://www.belighted.com/blog/float-is-evil"
article:
  title: "Float is evil"
  content: "<span id=\"hs_cos_wrapper_post_body\" class=\"hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text\" data-hs-cos-general-type=\"meta_field\" data-hs-cos-type=\"rich_text\"><p>Base 2 representation of real numbers is to me an artifact of the time when every single bit and every single flop mattered, but I have to admit that with the memory and computing power we have today, I don’t understand why modern languages do not use base 10 representation by default.</p>\n<!--more-->\n<p>Let me explain. It is important to remember that a number with a finite base 10 representation does not necessarily have a finite base 2 representation, and conversely. Of course, this problem is not inherent to base 2 but the fact is, in everyday life - some geeks apart - we compute in base 10: we expect 1/3 to have an infinite number of digits after the decimal point, not 12/10. In that respect, base 2 can sometime give some surprising results. To convince yourself, just type the following line in your Ruby console:</p>\n<figure class=\"code\">\n\n</figure>\n<p>For most computations errors are maybe small enough to ignore, but there is always the risk that they will add up. If your application handles money one way or another, this can become a real problem (accountants don’t like cents appearing or disappearing without reason).</p>\n<h2>The not so good idea: working with cents</h2>\n<p>I often read that to avoid base conversion errors when dealing with money, you should work in cents, as to only use integers. This may look like a simple and elegant solution, but it simply doesn’t work for two simple reasons.</p>\n<p>First, the cent is not <em>always</em> the smallest unit of money: just think about an application dealing with gas pump prices or exchange rates. Second, even if it is the case in your application, or you are working with nanocents, you will eventually end up with real numbers: divide 12 cents by 10 (e.g. to compute a mean) and you will be back at square one.</p>\n<h2>Decimal representation in your code and the database</h2>\n<p>Ruby and SQL allow you to store numbers in their decimal representation, using the <code>BigDecimal</code> and the <code>decimal</code> (sometimes also called <code>numeric</code>) field type, respectively. Behind the scenes, <code>Float</code> and <code>BigDecimal</code> both use a floating-point representation of the form <code>significant_digits x base^exp</code>; the difference being that the base is 2 if the first case, 10 in the second.</p>\n<p>Using <code>BigDecimal</code>, your calculations will therefore always return what a human being expects. Moreover, you can gain total control on your mathematical operations by specifying the precision (number of significant digits), scale (digits after the dot), and rounding strategy, ensuring you will never get unexpected results. <code>BigDecimal</code> also has the ability to represent special numbers such as Infinity or NaN.</p>\n<p>On the database side, just use the <code>decimal</code> type in your migration and specify a <code>precision</code> and <code>scale</code> (defaults can differ), ActiveRecord will take care of the rest. Even better: data from <code>decimal</code> fields will automatically by retrieved into <code>BigDecimal</code> objects.</p>\n<p>Read more:</p>\n<p><strong><a href=\"https://ruby-doc.org/stdlib-1.9.3/libdoc/bigdecimal/rdoc/BigDecimal.html\">BigDecimal Rdoc</a></strong></p>\n<p><strong><a href=\"https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/TableDefinition.html#method-i-column\">Precision and scale defaults of different RDBMS</a></strong></p>\n<p><br><!--HubSpot Call-to-Action Code --><span class=\"hs-cta-wrapper\" id=\"hs-cta-wrapper-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><span class=\"hs-cta-node hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" id=\"hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><!--[if lte IE 8]><div id=\"hs-cta-ie-element\"></div><![endif]--><a href=\"https://cta-redirect.hubspot.com/cta/redirect/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" target=\"_blank\"><img class=\"hs-cta-img\" id=\"hs-cta-img-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" src=\"https://no-cache.hubspot.com/cta/default/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2.png\" alt=\"New Call-to-action\"></a></span></span><!-- end HubSpot Call-to-Action Code --></p></span>"
  textBody: ""
  html: "<!--<![endif]--><head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n    <meta name=\"author\" content=\"Dominique L.\">\n    <meta name=\"description\" content=\"Are floats bad? What should be used in its place? I took some time to explain the problem behind a float number. Come have a look to this explanation.\">\n    <meta name=\"generator\" content=\"HubSpot\">\n    <title>Float is evil</title>\n    <link rel=\"shortcut icon\" href=\"https://www.belighted.com/hubfs/logo-belighted.png\">\n    \n\n    \n\n    <meta property=\"og:description\" content=\"Are floats bad? What should be used in its place? I took some time to explain the problem behind a float number. Come have a look to this explanation.\">\n    <meta property=\"og:title\" content=\"Float is evil\">\n    <meta name=\"twitter:description\" content=\"Are floats bad? What should be used in its place? I took some time to explain the problem behind a float number. Come have a look to this explanation.\">\n    <meta name=\"twitter:title\" content=\"Float is evil\">\n\n\n    <style>\na.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}\n</style>\n\n<link rel=\"stylesheet\" href=\"/hs/hsstatic/AsyncSupport/static-1.70/sass/comments_listing_asset.css\">\n<link rel=\"stylesheet\" href=\"/hs/hsstatic/AsyncSupport/static-1.70/sass/rss_post_listing.css\">\n    \n\n    \n    \n\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n\n<!-- Facebook Pixel Code -->\n\n<noscript>&lt;img  height=\"1\" width=\"1\" style=\"display:none\" src=\"https://www.facebook.com/tr?id=706355809571598&amp;amp;ev=PageView&amp;amp;noscript=1\"&gt;</noscript>\n<!-- End Facebook Pixel Code -->\n<link rel=\"amphtml\" href=\"https://www.belighted.com/blog/float-is-evil?hs_amp=true\">\n\n<meta property=\"og:image\" content=\"https://belighted.com/images/default_blogpost_image_0@1x.jpg#keepProtocol\">\n\n<meta name=\"twitter:image\" content=\"https://belighted.com/images/default_blogpost_image_0@1x.jpg#keepProtocol\">\n\n\n<meta property=\"og:url\" content=\"https://www.belighted.com/blog/float-is-evil\">\n<meta name=\"twitter:card\" content=\"summary\">\n\n<link rel=\"canonical\" href=\"https://www.belighted.com/blog/float-is-evil\">\n\n<meta property=\"og:type\" content=\"article\">\n<link rel=\"alternate\" type=\"application/rss+xml\" href=\"https://www.belighted.com/blog/rss.xml\">\n<meta name=\"twitter:domain\" content=\"www.belighted.com\">\n\n\n<meta http-equiv=\"content-language\" content=\"en\">\n<link rel=\"stylesheet\" href=\"//cdn2.hubspot.net/hub/-1/hub_generated/template_assets/1495141902003/hubspot_default/shared/responsive/layout.min.css\">\n\n\n<link rel=\"stylesheet\" href=\"https://www.belighted.com/hs-fs/hub/1684659/hub_generated/template_assets/8523445462/1569881984337/Marketplace/Neambo/Act21/Coded_Files/Act21.min.css\">\n\n\n\n\n</head>\n<body class=\"blog-1 featured-image-right   hs-content-id-4673386056 hs-blog-post hs-blog-id-4544204069\" style=\"\"></body>"

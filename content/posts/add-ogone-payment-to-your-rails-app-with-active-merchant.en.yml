lang: "en"
slug: "add-ogone-payment-to-your-rails-app-with-active-merchant"
originalPath: "https://www.belighted.com/blog/add-ogone-payment-to-your-rails-app-with-active-merchant"
article:
  title: "Add Ogone payment to your Rails app with active_merchant"
  content: "<span id=\"hs_cos_wrapper_post_body\" class=\"hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text\" data-hs-cos-general-type=\"meta_field\" data-hs-cos-type=\"rich_text\"><p>We recently added a few functionality to the <strong><a href=\"http://www.ogone.com/\">Ogone</a></strong> gateway of the popular <strong><a href=\"https://github.com/Shopify/active_merchant\">active_merchant</a></strong> payment processing gem, and felt it was a good time to take it from the top and detail how you can use this service in your own Rails application.</p>\n<!--more-->\n<blockquote>\n<p><strong>Warning:</strong> Handling and storing bank information is a dangerous task, and may be regulated in your country. Make sure your application conforms to the required norms and standards ( <strong><a href=\"https://www.pcisecuritystandards.org/security_standards/getting_started.php\">PSI DSS</a></strong> might be a good place to start) before implementing payment yourself.</p>\n<h2>Installation</h2>\n</blockquote>\n<p>As usual, you will need to add active_merchant to your Gemfile:</p>\n<figure class=\"code\">\n<figcaption><span>Gemfile </span></figcaption>\n\n</figure>\n<p>Then you need to create a new Ogone gateway with your account settings. Depending on how often and where you accept payments, you may want to put this in a initializer:</p>\n<figure class=\"code\">\n<figcaption><span>active_merchant.rb </span></figcaption>\n<div class=\"highlight\"><span>\n</span><table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">ActiveMerchant</span></span><span class=\"constant\"><span class=\"o\">::</span><span class=\"no\">Billing</span><span class=\"o\">::</span><span class=\"no\">OgoneGateway</span></span><span class=\"no\"></span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:login</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"login of your Ogone account (PDPID)\"</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:user</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"username of API user (Userid)\"</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:password</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"password for API user\"</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:signature</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"SHA-IN Pass phrase\"</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:signature_encryptor</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"sha512\"</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:test</span></span> <span class=\"o\">=&gt;</span> <span class=\"kp\"><span class=\"keyword\">true</span></span> <span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"p\">)</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table><span>\n</span></div>\n</figure>\n<h2>Usage</h2>\n<p>To make a simple payment, create a credit card and make a purchase with it:</p>\n<figure class=\"code\">\n<div class=\"highlight\"><span>\n</span><table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n<span class=\"line-number\">9</span>\n<span class=\"line-number\">10</span>\n<span class=\"line-number\">11</span>\n<span class=\"line-number\">12</span>\n<span class=\"line-number\">13</span>\n<span class=\"line-number\">14</span>\n<span class=\"line-number\">15</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"n\">credit_card</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">ActiveMerchant</span></span><span class=\"constant\"><span class=\"o\">::</span><span class=\"no\">Billing</span><span class=\"o\">::</span><span class=\"no\">CreditCard</span></span><span class=\"no\"></span><span class=\"o\">.</span><span class=\"n\">new</span><span class=\"p\">(</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:first_name</span></span> <span class=\"o\">=&gt;</span> <span class=\"s1\"><span class=\"string\">'John'</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:last_name</span></span> <span class=\"o\">=&gt;</span> <span class=\"s1\"><span class=\"string\">'Matrix'</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:number</span></span> <span class=\"o\">=&gt;</span> <span class=\"s1\"><span class=\"string\">'4111 1111 1111 1111'</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:month</span></span> <span class=\"o\">=&gt;</span> <span class=\"mi\"><span class=\"number\">4</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:year</span></span> <span class=\"o\">=&gt;</span> <span class=\"mi\"><span class=\"number\">2013</span></span><span class=\"p\">,</span>\n</span><span class=\"line\"> <span class=\"ss\"><span class=\"symbol\">:verification_value</span></span> <span class=\"o\">=&gt;</span> <span class=\"mi\"><span class=\"number\">123</span></span> <span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">purchase</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1000</span></span><span class=\"p\">,</span> <span class=\"n\">credit_card</span><span class=\"p\">,</span> <span class=\"ss\"><span class=\"symbol\">:order_id</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"1\"</span></span><span class=\"p\">,</span> <span class=\"ss\"><span class=\"symbol\">:store</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"john_matrix\"</span></span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"nb\">puts</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">success?</span> <span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"nb\">puts</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">message</span> <span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"nb\">puts</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">authorization</span> <span class=\"c1\"></span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table><span>\n</span></div>\n</figure>\n<p><code>order_id</code> is optional, and will be automatically generated by Ogone if left blank. <code>store</code> is optional and used to remember a credit card that will be used regularly, but more on this in a while.</p>\n<h2>Refunds and authorization</h2>\n<p>Making a refund is as easy as charging a customer, simply call <code>refund</code> with the authorization you received after calling <code>purchase</code>:</p>\n<figure class=\"code\">\n<div class=\"highlight\"><span>\n</span><table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">refund_response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">refund</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1000</span></span><span class=\"p\">,</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">authorization</span><span class=\"p\">)</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table><span>\n</span></div>\n</figure>\n<p>Transactions can also be done in two steps. First, we will <code>authorize</code> the amount on the credit card, which will make sure it is available, and freeze it on the credit card for 7 days. Within these 7 days, we can then <code>capture</code> the amount to make the actual transaction.</p>\n<figure class=\"code\">\n<div class=\"highlight\"><span>\n</span><table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">authorize</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1000</span></span><span class=\"p\">,</span> <span class=\"n\">credit_card</span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">capture_response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">capture</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1000</span></span><span class=\"p\">,</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">authorization</span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">void_response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">void</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\">authorization</span><span class=\"p\">)</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table><span>\n</span></div>\n</figure>\n<h2>Storing credit cards</h2>\n<p>As I mentioned before, you can store credit cards you charge regularly using Ogone’s Alias feature. This can be done either at the first purchase with the <code>store</code> option, or using the new <code>store</code> method.</p>\n<figure class=\"code\">\n<div class=\"highlight\"><span>\n</span><table>\n<tbody>\n<tr>\n<td class=\"gutter\">\n<pre class=\"line-numbers\"><span class=\"line-number\">1</span>\n<span class=\"line-number\">2</span>\n<span class=\"line-number\">3</span>\n<span class=\"line-number\">4</span>\n<span class=\"line-number\">5</span>\n<span class=\"line-number\">6</span>\n<span class=\"line-number\">7</span>\n<span class=\"line-number\">8</span>\n<span class=\"line-number\">9</span>\n<span class=\"line-number\">10</span>\n<span class=\"line-number\">11</span>\n<span class=\"line-number\">12</span>\n<span class=\"line-number\">13</span>\n<span class=\"line-number\">14</span>\n<span class=\"line-number\">15</span>\n</pre>\n</td>\n<td class=\"code\">\n<pre><code class=\"ruby\"><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">purchase</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1000</span></span><span class=\"p\">,</span> <span class=\"n\">credit_card</span><span class=\"p\">,</span> <span class=\"ss\"><span class=\"symbol\">:store</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"john_matrix\"</span></span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">store</span><span class=\"p\">(</span><span class=\"n\">credit_card</span><span class=\"p\">,</span> <span class=\"ss\"><span class=\"symbol\">:store</span></span> <span class=\"o\">=&gt;</span> <span class=\"s2\"><span class=\"string\">\"john_matrix\"</span></span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">store</span><span class=\"p\">(</span><span class=\"n\">credit_card</span><span class=\"p\">)</span>\n</span><span class=\"line\"><span class=\"nb\">puts</span> <span class=\"n\">response</span><span class=\"o\">.</span><span class=\"n\"><span class=\"keyword\">alias</span></span> <span class=\"c1\"></span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">new_response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">purchase</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">2000</span></span><span class=\"p\">,</span> <span class=\"s2\"><span class=\"string\">\"john_matrix\"</span></span><span class=\"p\">)</span>\n</span><span class=\"line\">\n</span><span class=\"line\"><span class=\"c1\"></span>\n</span><span class=\"line\"><span class=\"n\">new_response</span> <span class=\"o\">=</span> <span class=\"no\"><span class=\"constant\">OGONE_GATEWAY</span></span><span class=\"o\">.</span><span class=\"n\">authorize</span><span class=\"p\">(</span><span class=\"mi\"><span class=\"number\">1500</span></span><span class=\"p\">,</span> <span class=\"s2\"><span class=\"string\">\"john_matrix\"</span></span><span class=\"p\">)</span>\n</span></code></pre>\n</td>\n</tr>\n</tbody>\n</table><span>\n</span><p><!--HubSpot Call-to-Action Code --><span class=\"hs-cta-wrapper\" id=\"hs-cta-wrapper-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><span class=\"hs-cta-node hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" id=\"hs-cta-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\"><!--[if lte IE 8]><div id=\"hs-cta-ie-element\"></div><![endif]--><a href=\"https://cta-redirect.hubspot.com/cta/redirect/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" target=\"_blank\"><img class=\"hs-cta-img\" id=\"hs-cta-img-fb3606cc-cc1b-47d0-ae85-2c9f69837fe2\" src=\"https://no-cache.hubspot.com/cta/default/1684659/fb3606cc-cc1b-47d0-ae85-2c9f69837fe2.png\" alt=\"New Call-to-action\"></a></span></span><!-- end HubSpot Call-to-Action Code --></p><span>\n</span></div>\n</figure>\n</span>"
  textBody: ""
  html: "<!--<![endif]--><head>\n    <meta charset=\"utf-8\">\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\">\n    <meta name=\"author\" content=\"Joel C.\">\n    <meta name=\"description\" content=\"We recently added a few functionality to the Ogone payment processing gem. It's a good time to take it from the top and detail how you can use this service in your own Rails application.\">\n    <meta name=\"generator\" content=\"HubSpot\">\n    <title>Add Ogone payment to your Rails app with active_merchant</title>\n    <link rel=\"shortcut icon\" href=\"https://www.belighted.com/hubfs/logo-belighted.png\">\n    \n\n    \n\n    <meta property=\"og:description\" content=\"We recently added a few functionality to the Ogone payment processing gem. It's a good time to take it from the top and detail how you can use this service in your own Rails application.\">\n    <meta property=\"og:title\" content=\"Add Ogone payment to your Rails app with active_merchant\">\n    <meta name=\"twitter:description\" content=\"We recently added a few functionality to the Ogone payment processing gem. It's a good time to take it from the top and detail how you can use this service in your own Rails application.\">\n    <meta name=\"twitter:title\" content=\"Add Ogone payment to your Rails app with active_merchant\">\n\n\n    <style>\na.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}\n</style>\n\n<link rel=\"stylesheet\" href=\"/hs/hsstatic/AsyncSupport/static-1.70/sass/comments_listing_asset.css\">\n<link rel=\"stylesheet\" href=\"/hs/hsstatic/AsyncSupport/static-1.70/sass/rss_post_listing.css\">\n    \n\n    \n    \n\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n\n<!-- Facebook Pixel Code -->\n\n<noscript>&lt;img  height=\"1\" width=\"1\" style=\"display:none\" src=\"https://www.facebook.com/tr?id=706355809571598&amp;amp;ev=PageView&amp;amp;noscript=1\"&gt;</noscript>\n<!-- End Facebook Pixel Code -->\n<link rel=\"amphtml\" href=\"https://www.belighted.com/blog/add-ogone-payment-to-your-rails-app-with-active-merchant?hs_amp=true\">\n\n<meta property=\"og:image\" content=\"http://belighted.com/images/default_blogpost_image_1@1x.jpg#keepProtocol\">\n\n<meta name=\"twitter:image\" content=\"http://belighted.com/images/default_blogpost_image_1@1x.jpg#keepProtocol\">\n\n\n<meta property=\"og:url\" content=\"https://www.belighted.com/blog/add-ogone-payment-to-your-rails-app-with-active-merchant\">\n<meta name=\"twitter:card\" content=\"summary\">\n\n<link rel=\"canonical\" href=\"https://www.belighted.com/blog/add-ogone-payment-to-your-rails-app-with-active-merchant\">\n\n<meta property=\"og:type\" content=\"article\">\n<link rel=\"alternate\" type=\"application/rss+xml\" href=\"https://www.belighted.com/blog/rss.xml\">\n<meta name=\"twitter:domain\" content=\"www.belighted.com\">\n\n\n<meta http-equiv=\"content-language\" content=\"en\">\n<link rel=\"stylesheet\" href=\"//cdn2.hubspot.net/hub/-1/hub_generated/template_assets/1495141902003/hubspot_default/shared/responsive/layout.min.css\">\n\n\n<link rel=\"stylesheet\" href=\"https://www.belighted.com/hs-fs/hub/1684659/hub_generated/template_assets/8523445462/1569881984337/Marketplace/Neambo/Act21/Coded_Files/Act21.min.css\">\n\n\n\n\n</head>\n<body class=\"blog-1 featured-image-right   hs-content-id-4674082336 hs-blog-post hs-blog-id-4544204069\" style=\"\"></body>"
